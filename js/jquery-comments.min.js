//     jquery-comments.js 1.2.12
//     (c) 2017 Joona TykkylÃ¤inen, Viima Solutions Oy
//     jquery-comments may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://viima.github.io/jquery-comments/
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){var t={$el:null,commentsById:{},usersById:{},dataFetched:!1,currentSortKey:"",options:{},events:{click:"closeDropdowns","keydown [contenteditable]":"saveOnKeydown","focus [contenteditable]":"saveEditableContent","keyup [contenteditable]":"checkEditableContentForChange","paste [contenteditable]":"checkEditableContentForChange","input [contenteditable]":"checkEditableContentForChange","blur [contenteditable]":"checkEditableContentForChange","click .navigation li[data-sort-key]":"navigationElementClicked","click .navigation li.title":"toggleNavigationDropdown","click .commenting-field.main .textarea":"showMainCommentingField","click .commenting-field.main .close":"hideMainCommentingField","click .commenting-field .textarea":"increaseTextareaHeight","change .commenting-field .textarea":"increaseTextareaHeight textareaContentChanged","click .commenting-field:not(.main) .close":"removeCommentingField","click .commenting-field .send.enabled":"postComment","click .commenting-field .update.enabled":"putComment",'change .commenting-field .upload.enabled input[type="file"]':"fileInputChanged","click li.comment button.upvote":"upvoteComment","click li.comment button.downvote":"downvoteComment","click li.comment div.delete.enabled":"deleteComment","click li.comment .hashtag":"hashtagClicked","click li.comment .ping":"pingClicked","click li.comment ul.child-comments .toggle-all":"toggleReplies","click li.comment div.reply":"replyButtonClicked","click li.comment div.edit":"editButtonClicked",dragenter:"showDroppableOverlay","dragenter .droppable-overlay":"handleDragEnter","dragleave .droppable-overlay":"handleDragLeaveForOverlay","dragenter .droppable-overlay .droppable":"handleDragEnter","dragleave .droppable-overlay .droppable":"handleDragLeaveForDroppable","dragover .droppable-overlay":"handleDragOverForOverlay","drop .droppable-overlay":"handleDrop","click .dropdown.autocomplete":"stopPropagation","mousedown .dropdown.autocomplete":"stopPropagation","touchstart .dropdown.autocomplete":"stopPropagation"},getDefaultOptions:function(){return{profilePictureURL:"",currentUserIsAdmin:!1,currentUserId:null,spinnerIconURL:"",upvoteIconURL:"",downvoteIconURL:"",replyIconURL:"",uploadIconURL:"",attachmentIconURL:"",fileIconURL:"",noCommentsIconURL:"",textareaPlaceholderText:"Add to the discussion...",newestText:"Newest",oldestText:"Oldest",popularText:"Popular",attachmentsText:"Attachments",sendText:"Publish",replyText:"Reply",editText:"Edit",editedText:"Edited",youText:"You",saveText:"Save",deleteText:"Delete",newText:"New",viewAllRepliesText:"View all __replyCount__ replies",hideRepliesText:"Hide replies",noCommentsText:"No comments",noAttachmentsText:"No attachments",attachmentDropText:"Drop files here",textFormatter:function(e){return e},enableReplying:!0,enableEditing:!0,enableUpvoting:!0,enableDownvoting:!0,enableDeleting:!0,enableAttachments:!1,enableHashtags:!1,enablePinging:!1,enableDeletingCommentWithReplies:!1,enableNavigation:!0,postCommentOnEnter:!1,forceResponsive:!1,readOnly:!1,defaultNavigationSortKey:"newest",highlightColor:"#2793e6",deleteButtonColor:"#C9302C",scrollContainer:this.$el,roundProfilePictures:!0,textareaRows:3,textareaRowsOnFocus:5,textareaMaxRows:7,maxRepliesVisible:2,audioContext:null,fieldMappings:{id:"id",parent:"parent",created:"created",modified:"modified",content:"content",file:"file",fileName:"file_name",fileURL:"file_url",fileMimeType:"file_mime_type",pings:"pings",creator:"creator",fullname:"fullname",profileURL:"profile_url",profilePictureURL:"profile_picture_url",isNew:"is_new",createdByAdmin:"created_by_admin",createdByCurrentUser:"created_by_current_user",upvoteCount:"upvote_count",userHasUpvoted:"user_has_upvoted",downvoteCount:"downvote_count",userHasDownvoted:"user_has_downvoted"},getUsers:function(e,t){e([])},getComments:function(e,t){e([])},postComment:function(e,t,n){t(e)},putComment:function(e,t,n){t(e)},deleteComment:function(e,t,n){t()},upvoteComment:function(e,t,n){t(e)},downvoteComment:function(e,t,n){t(e)},hashtagClicked:function(e){},pingClicked:function(e){},uploadAttachments:function(e,t,n){t(e)},refresh:function(){},timeFormatter:function(e){return new Date(e).toLocaleDateString()}}},init:function(t,n){this.$el=e(n),this.$el.addClass("jquery-comments"),this.undelegateEvents(),this.delegateEvents(),function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),e.browser.mobile&&this.$el.addClass("mobile"),this.options=e.extend(!0,{},this.getDefaultOptions(),t),this.options.readOnly&&this.$el.addClass("read-only"),this.currentSortKey=this.options.defaultNavigationSortKey,this.createCssDeclarations(),this.fetchDataAndRender()},delegateEvents:function(){this.bindEvents(!1)},undelegateEvents:function(){this.bindEvents(!0)},bindEvents:function(t){var n=t?"off":"on"
for(var i in this.events){var a=i.split(" ")[0],o=i.split(" ").slice(1).join(" "),r=this.events[i].split(" ")
for(var s in r)if(r.hasOwnProperty(s)){var l=this[r[s]]
l=e.proxy(l,this),""===o?this.$el[n](a,l):this.$el[n](a,o,l)}}},fetchDataAndRender:function(){var t=this
this.commentsById={},this.usersById={},this.$el.empty(),this.createHTML()
var n=this.after(this.options.enablePinging?2:1,function(){t.dataFetched=!0,t.render()}),i=function(i){var a=i.map(function(e){return t.createCommentModel(e)})
t.sortComments(a,"oldest"),e(a).each(function(e,n){t.addCommentToDataModel(n)}),n()}
if(this.options.getComments(i,n),this.options.enablePinging){var a=function(i){e(i).each(function(e,n){t.usersById[n.id]=n}),n()}
this.options.getUsers(a,n)}},fetchNext:function(){var t=this,n=this.createSpinner()
this.$el.find("ul#comment-list").append(n)
var i=function(i){e(i).each(function(e,n){t.createComment(n)}),n.remove()},a=function(){n.remove()}
this.options.getComments(i,a)},createCommentModel:function(e){var t=this.applyInternalMappings(e)
return t.childs=[],t},addCommentToDataModel:function(e){if(!(e.id in this.commentsById)&&(this.commentsById[e.id]=e,e.parent)){this.getOutermostParent(e.parent).childs.push(e.id)}},updateCommentModel:function(t){e.extend(this.commentsById[t.id],t)},render:function(){this.dataFetched&&(this.showActiveContainer(),this.createComments(),this.options.enableAttachments&&this.createAttachments(),this.$el.find("> .spinner").remove(),this.options.refresh())},showActiveContainer:function(){var e=this.$el.find(".navigation li[data-container-name].active"),t=e.data("container-name"),n=this.$el.find('[data-container="'+t+'"]')
n.siblings("[data-container]").hide(),n.show()},createComments:function(){var t=this
this.$el.find("#comment-list").remove()
var n=e("<ul/>",{id:"comment-list",class:"main"}),i=[],a=[]
e(this.getComments()).each(function(e,t){null==t.parent?i.push(t):a.push(t)}),this.sortComments(i,this.currentSortKey),i.reverse(),e(i).each(function(e,i){t.addComment(i,n)}),this.sortComments(a,"oldest"),e(a).each(function(e,i){t.addComment(i,n)}),this.$el.find('[data-container="comments"]').prepend(n)},createAttachments:function(){var t=this
this.$el.find("#attachment-list").remove()
var n=e("<ul/>",{id:"attachment-list",class:"main"}),i=this.getAttachments()
this.sortComments(i,"newest"),i.reverse(),e(i).each(function(e,i){t.addAttachment(i,n)}),this.$el.find('[data-container="attachments"]').prepend(n)},addComment:function(e,t){t=t||this.$el.find("#comment-list")
var n=this.createCommentElement(e)
if(e.parent){var i=t.find('.comment[data-id="'+e.parent+'"]')
this.reRenderCommentActionBar(e.parent)
var a=i.parents(".comment").last()
0===a.length&&(a=i)
var o=a.find(".child-comments"),r=o.find(".commenting-field")
r.length?r.before(n):o.append(n),this.updateToggleAllButton(a)}else t.prepend(n)},addAttachment:function(e,t){t=t||this.$el.find("#attachment-list")
var n=this.createCommentElement(e)
t.prepend(n)},removeComment:function(t){var n=this,i=this.commentsById[t],a=this.getChildComments(i.id)
if(e(a).each(function(e,t){n.removeComment(t.id)}),i.parent){var o=this.getOutermostParent(i.parent),r=o.childs.indexOf(i.id)
o.childs.splice(r,1)}delete this.commentsById[t]
var s=this.$el.find('li.comment[data-id="'+t+'"]'),l=s.parents("li.comment").last()
s.remove(),this.updateToggleAllButton(l)},uploadAttachments:function(t,n){var i=this
n||(n=this.$el.find(".commenting-field.main"))
var a=n.find(".upload"),o=!n.hasClass("main"),r=t.length
if(r){var s=n.find(".textarea")
a.removeClass("enabled")
var l=this.createSpinner(),d=this.createSpinner()
this.$el.find("ul#attachment-list").prepend(l),o?n.before(d):this.$el.find("ul#comment-list").prepend(d)
var c=function(t){e(t).each(function(e,t){var n=i.createCommentModel(t)
i.addCommentToDataModel(n),i.addComment(n),i.addAttachment(n)}),t.length===r&&0===i.getTextareaContent(s).length&&n.find(".close").trigger("click"),a.addClass("enabled"),d.remove(),l.remove()},p=function(){a.addClass("enabled"),d.remove(),l.remove()},m=[]
e(t).each(function(e,t){var n=i.createCommentJSON(s)
n.id+="-"+e,n.content="",n.file=t,n.fileName=t.name,n.fileURL="C:/fakepath/"+t.name,n.fileMimeType=t.type,n=i.applyExternalMappings(n),m.push(n)}),i.options.uploadAttachments(m,c,p)}a.find("input").val("")},updateToggleAllButton:function(t){if(null!=this.options.maxRepliesVisible){var n=t.find(".child-comments"),i=n.find(".comment"),a=n.find("li.toggle-all")
i.removeClass("hidden-reply")
var o
if(o=0===this.options.maxRepliesVisible?i:i.slice(0,-this.options.maxRepliesVisible),o.addClass("hidden-reply"),a.find("span.text").text()===this.options.textFormatter(this.options.hideRepliesText)&&o.addClass("visible"),i.length>this.options.maxRepliesVisible){if(!a.length){a=e("<li/>",{class:"toggle-all highlight-font-bold"})
var r=e("<span/>",{class:"text"}),s=e("<span/>",{class:"caret"})
a.append(r).append(s),n.prepend(a)}this.setToggleAllButtonText(a,!1)}else a.remove()}},sortComments:function(e,t){var n=this
"popularity"===t?e.sort(function(e,t){var i=e.childs.length,a=t.childs.length
if(n.options.enableUpvoting&&(i+=e.upvoteCount+e.downvoteCount,a+=t.upvoteCount+t.downvoteCount),a!==i)return a-i
var o=new Date(e.created).getTime()
return new Date(t.created).getTime()-o}):e.sort(function(e,n){var i=new Date(e.created).getTime(),a=new Date(n.created).getTime()
return"oldest"===t?i-a:a-i})},sortUsers:function(e){e.sort(function(e,t){var n=e.fullname.toLowerCase().trim(),i=t.fullname.toLowerCase().trim()
return n<i?-1:n>i?1:0})},sortAndReArrangeComments:function(t){var n=this.$el.find("#comment-list"),i=this.getComments().filter(function(e){return!e.parent})
this.sortComments(i,t),e(i).each(function(e,t){var i=n.find("> li.comment[data-id="+t.id+"]")
n.append(i)})},showActiveSort:function(){var e=this.$el.find('.navigation li[data-sort-key="'+this.currentSortKey+'"]')
this.$el.find(".navigation li").removeClass("active"),e.addClass("active")
var t=this.$el.find(".navigation .title")
if("attachments"!==this.currentSortKey)t.addClass("active"),t.find("header").html(e.first().html())
else{var n=this.$el.find(".navigation ul.dropdown").children().first()
t.find("header").html(n.html())}this.showActiveContainer()},forceResponsive:function(){this.$el.addClass("responsive")},closeDropdowns:function(){this.$el.find(".dropdown").hide()},saveOnKeydown:function(t){if(13===t.keyCode){var n=t.metaKey||t.ctrlKey
if(!this.options.postCommentOnEnter&&!n)return document.execCommand("insertHTML",!1,"<br><br>"),!1
e(t.currentTarget).siblings(".control-row").find(".save").trigger("click"),t.stopPropagation(),t.preventDefault()}},saveEditableContent:function(t){var n=e(t.currentTarget)
n.data("before",n.html())},checkEditableContentForChange:function(t){var n=e(t.currentTarget)
n.data("before")!==n.html()&&(n.data("before",n.html()),n.trigger("change"))},navigationElementClicked:function(t){var n=e(t.currentTarget),i=n.data().sortKey
"attachments"!==i&&this.sortAndReArrangeComments(i),this.currentSortKey=i,this.showActiveSort()},toggleNavigationDropdown:function(t){t.stopPropagation(),e(t.currentTarget).find("~ .dropdown").toggle()},showMainCommentingField:function(t){var n=e(t.currentTarget)
n.siblings(".control-row").show(),n.parent().find(".close").show(),n.parent().find(".upload.inline-button").hide(),n.focus()},hideMainCommentingField:function(t){var n=e(t.currentTarget),i=this.$el.find(".commenting-field.main .textarea"),a=this.$el.find(".commenting-field.main .control-row")
this.clearTextarea(i),this.adjustTextareaHeight(i,!1),a.hide(),n.hide(),i.parent().find(".upload.inline-button").show(),i.blur()},increaseTextareaHeight:function(t){var n=e(t.currentTarget)
this.adjustTextareaHeight(n,!0)},textareaContentChanged:function(t){var n,i=e(t.currentTarget),a=i.siblings(".control-row").find(".save")
if(!i.find(".reply-to.tag").length){n=i.attr("data-comment")
var o
if(n){var r=i.parents("li.comment")
r.length>1&&(o=r.last().data("id"),i.attr("data-parent",o))}else o=i.parents("li.comment").last().data("id"),i.attr("data-parent",o)}var s=i.parents(".commenting-field").first()
i[0].scrollHeight>i.outerHeight()?s.addClass("scrollable"):s.removeClass("scrollable")
var l=!0,d=this.getTextareaContent(i,!0)
if((n=i.attr("data-comment"))&&this.commentsById[n]){var c,p=d!==this.commentsById[n].content
this.commentsById[n].parent&&(c=this.commentsById[n].parent.toString())
var m=i.attr("data-parent")!==c
l=p||m}d.length&&l?a.addClass("enabled"):a.removeClass("enabled")},removeCommentingField:function(t){var n=e(t.currentTarget)
n.siblings(".textarea").attr("data-comment")&&n.parents("li.comment").first().removeClass("edit"),n.parents(".commenting-field").first().remove()},postComment:function(t){var n=this,i=e(t.currentTarget),a=i.parents(".commenting-field").first(),o=a.find(".textarea")
i.removeClass("enabled")
var r=this.createCommentJSON(o)
r=this.applyExternalMappings(r)
var s=function(e){n.createComment(e),a.find(".close").trigger("click")},l=function(){i.addClass("enabled")}
this.options.postComment(r,s,l)},createComment:function(e){var t=this.createCommentModel(e)
this.addCommentToDataModel(t),this.addComment(t)},putComment:function(t){var n=this,i=e(t.currentTarget),a=i.parents(".commenting-field").first(),o=a.find(".textarea")
i.removeClass("enabled")
var r=e.extend({},this.commentsById[o.attr("data-comment")])
e.extend(r,{parent:o.attr("data-parent")||null,content:this.getTextareaContent(o),pings:this.getPings(o),modified:(new Date).getTime()}),r=this.applyExternalMappings(r)
var s=function(e){var t=n.createCommentModel(e)
delete t.childs,n.updateCommentModel(t),a.find(".close").trigger("click"),n.reRenderComment(t.id)},l=function(){i.addClass("enabled")}
this.options.putComment(r,s,l)},deleteComment:function(t){var n=this,i=e(t.currentTarget),a=i.parents(".comment").first(),o=e.extend({},this.commentsById[a.attr("data-id")]),r=o.id,s=o.parent
i.removeClass("enabled"),o=this.applyExternalMappings(o)
var l=function(){return n.removeComment(r),s&&n.reRenderCommentActionBar(s),n.commentsById},d=function(){i.addClass("enabled")}
this.options.deleteComment(o,l,d)},hashtagClicked:function(t){var n=e(t.currentTarget),i=n.attr("data-value")
this.options.hashtagClicked(i)},pingClicked:function(t){var n=e(t.currentTarget),i=n.attr("data-value")
this.options.pingClicked(i)},fileInputChanged:function(t,n){var i=t.currentTarget.files,a=e(t.currentTarget).parents(".commenting-field").first()
i[0]&&(i[0].size<=2048e3?this.uploadAttachments(i,a):(e(t.currentTarget).prop("value",""),window.alert("File size should be maximum 2MB.")))},upvoteComment:function(t){var n,i=this,a=e(t.currentTarget).parents("li.comment").first(),o=a.data().model,r=o.upvoteCount
n=o.userHasUpvoted?r-1:r+1,o.userHasUpvoted=!o.userHasUpvoted,o.upvoteCount=n,this.reRenderUpvotes(o.id)
var s=e.extend({},o)
s=this.applyExternalMappings(s)
var l=function(e){var t=i.createCommentModel(e)
i.updateCommentModel(t),i.reRenderUpvotes(t.id),t.userHasDownvoted=!t.userHasDownvoted,t.downvoteCount=t.downvoteCount--,i.reRenderDownvotes(t.id)},d=function(){o.userHasUpvoted=!o.userHasUpvoted,o.upvoteCount=r,i.reRenderUpvotes(o.id)}
this.options.upvoteComment(s,l,d)},downvoteComment:function(t){var n,i=this,a=e(t.currentTarget).parents("li.comment").first(),o=a.data().model,r=o.downvoteCount
n=o.userHasDownvoted?r-1:r+1,o.userHasDownvoted=!o.userHasDownvoted,o.downvoteCount=n,this.reRenderDownvotes(o.id)
var s=e.extend({},o)
s=this.applyExternalMappings(s)
var l=function(e){var t=i.createCommentModel(e)
i.updateCommentModel(t),i.reRenderDownvotes(t.id),t.userHasUpvoted=!t.userHasUpvoted,t.upvoteCount=t.upvoteCount--,i.reRenderUpvotes(t.id)},d=function(){o.userHasDownvoted=!o.userHasDownvoted,o.downvoteCount=r,i.reRenderDownvotes(o.id)}
this.options.downvoteComment(s,l,d)},toggleReplies:function(t){var n=e(t.currentTarget)
n.siblings(".hidden-reply").toggleClass("visible"),this.setToggleAllButtonText(n,!0)},replyButtonClicked:function(t){var n=e(t.currentTarget),i=n.parents("li.comment").last(),a=n.parents(".comment").first().data().id,o=i.find(".child-comments > .commenting-field")
if(o.length&&o.remove(),o.find(".textarea").attr("data-parent")!==a){o=this.createCommentingFieldElement(a),i.find(".child-comments").append(o)
var r=o.find(".textarea")
this.moveCursorToEnd(r)
var s=this.options.scrollContainer.scrollTop(),l=s+o.position().top+o.outerHeight(),d=s+this.options.scrollContainer.outerHeight()
if(l>d){var c=s+(l-d)
this.options.scrollContainer.scrollTop(c)}}},editButtonClicked:function(t){var n=e(t.currentTarget),i=n.parents("li.comment").first(),a=i.data().model
i.addClass("edit")
var o=this.createCommentingFieldElement(a.parent,a.id)
i.find(".comment-wrapper").first().append(o)
var r=o.find(".textarea")
r.attr("data-comment",a.id),r.append(this.getFormattedCommentContent(a.content,!0)),this.moveCursorToEnd(r)},showDroppableOverlay:function(e){this.options.enableAttachments&&(this.$el.find(".droppable-overlay").css("top",this.$el[0].scrollTop),this.$el.find(".droppable-overlay").show(),this.$el.addClass("drag-ongoing"))},handleDragEnter:function(t){var n=e(t.currentTarget).data("dnd-count")||0
n++,e(t.currentTarget).data("dnd-count",n),e(t.currentTarget).addClass("drag-over")},handleDragLeave:function(t,n){var i=e(t.currentTarget).data("dnd-count")
i--,e(t.currentTarget).data("dnd-count",i),0===i&&(e(t.currentTarget).removeClass("drag-over"),n&&n())},handleDragLeaveForOverlay:function(e){var t=this
this.handleDragLeave(e,function(){t.hideDroppableOverlay()})},handleDragLeaveForDroppable:function(e){this.handleDragLeave(e)},handleDragOverForOverlay:function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},hideDroppableOverlay:function(){this.$el.find(".droppable-overlay").hide(),this.$el.removeClass("drag-ongoing")},handleDrop:function(t){t.preventDefault(),e(t.target).trigger("dragleave"),this.hideDroppableOverlay()
var n=t.originalEvent.dataTransfer.files
n[0]&&(n[0].size<=2048e3?this.uploadAttachments(t.originalEvent.dataTransfer.files):window.alert("File size should be maximum 2MB."))},stopPropagation:function(e){e.stopPropagation()},createHTML:function(){var t=this.createMainCommentingFieldElement()
this.$el.append(t),t.find(".control-row").hide(),t.find(".close").hide(),this.options.enableNavigation&&(this.$el.append(this.createNavigationElement()),this.showActiveSort())
var n=this.createSpinner()
this.$el.append(n)
var i=e("<div/>",{class:"data-container","data-container":"comments"})
this.$el.append(i)
var a=e("<div/>",{class:"no-comments no-data",text:this.options.textFormatter(this.options.noCommentsText)}),o=e("<i/>",{class:"fa fa-comments fa-2x"})
if(this.options.noCommentsIconURL.length&&(o.css("background-image",'url("'+this.options.noCommentsIconURL+'")'),o.addClass("image")),a.prepend(e("<br/>")).prepend(o),i.append(a),this.options.enableAttachments){var r=e("<div/>",{class:"data-container","data-container":"attachments"})
this.$el.append(r)
var s=e("<div/>",{class:"no-attachments no-data",text:this.options.textFormatter(this.options.noAttachmentsText)}),l=e("<i/>",{class:"fa fa-paperclip fa-2x"})
this.options.attachmentIconURL.length&&(l.css("background-image",'url("'+this.options.attachmentIconURL+'")'),l.addClass("image")),s.prepend(e("<br/>")).prepend(l),r.append(s)
var d=e("<div/>",{class:"droppable-overlay"}),c=e("<div/>",{class:"droppable-container"}),p=e("<div/>",{class:"droppable"}),m=e("<i/>",{class:"fa fa-upload fa-4x"})
this.options.uploadIconURL.length&&(m.css("background-image",'url("'+this.options.uploadIconURL+'")'),m.addClass("image"))
var h=e("<div/>",{text:this.options.textFormatter(this.options.attachmentDropText)})
p.append(m),p.append(h),d.html(c.html(p)).hide(),this.$el.append(d)}},createProfilePictureElement:function(t){var n
n=t?e("<img/>",{src:t}):e("<i/>",{class:"fa fa-user"}),n.addClass("profile-picture")
var i=e("<div/>",{class:"profile-picture-wrapper"})
return i.append(n),this.options.roundProfilePictures&&n.addClass("round"),i},createMainCommentingFieldElement:function(){return this.createCommentingFieldElement(void 0,void 0,!0)},createCommentingFieldElement:function(t,n,i){var a=this,o=e("<div/>",{class:"commenting-field"})
i&&o.addClass("main")
var r
r=n?this.commentsById[n].profilePictureURL:this.options.profilePictureURL
var s=this.createProfilePictureElement(r),l=e("<div/>",{class:"textarea-wrapper"}),d=e("<div/>",{class:"control-row"}),c=e("<div/>",{class:"textarea","data-placeholder":this.options.textFormatter(this.options.textareaPlaceholderText),contenteditable:!0})
this.profilePictureWrapper=s,this.adjustTextareaHeight(c,!1)
var p=e('<i class="material-icons">close</i>')
p.addClass("close inline-button")
var m
if(n){m=this.options.textFormatter(this.options.saveText)
var h=e("<div/>",{class:"mdl-button delete",text:this.options.textFormatter(this.options.deleteText)}).css("color",this.options.deleteButtonColor)
d.append(h),this.isAllowedToDelete(n)&&h.addClass("enabled")}else if(m=this.options.textFormatter(this.options.sendText),this.options.enableAttachments){var u=e("<div/>",{class:"mdl-button enabled upload"}),f=e('<i class="material-icons">attachment</i>'),g=e("<input/>",{type:"file","data-role":"none"})
e.browser.mobile||g.attr("multiple","multiple"),this.options.uploadIconURL.length&&(f.css("background-image",'url("'+this.options.uploadIconURL+'")'),f.addClass("image")),u.append(f).append(g),d.append(u.clone()),i&&l.append(u.clone().addClass("inline-button"))}var v=n?"update":"send",C=e("<div/>",{class:v+" mdl-button save",text:m}).css("color",this.options.highlightColor)
if(d.prepend(C),l.append(p).append(c).append(d),o.append(s).append(l),t){c.attr("data-parent",t)
var b=this.commentsById[t]
if(b.parent){c.html("&nbsp;")
var w="@"+b.fullname,y=this.createTagElement(w,"reply-to",b.creator)
c.prepend(y)}}return this.options.enablePinging&&(c.textcomplete([{match:/(^|\s)@(([a-zÃ¤Ã¶Ã¼Ã]|\s)*)$/im,search:function(t,n){t=a.normalizeSpaces(t)
var i=a.getPings(c),o=a.getUsers().filter(function(e){var t=e.id===a.options.currentUserId,n=-1!==i.indexOf(e.id)
return!t&&!n})
a.sortUsers(o),n(e.map(o,function(n){var i=t.split(" "),a=n.fullname.split(" "),o=!0
return e(i).each(function(t,n){var i=n.toLowerCase().trim(),r=!1
e(a).each(function(e,t){0===t.toLowerCase().trim().indexOf(i)&&(r=!0)}),r||(o=!1)}),o?n:null}))},template:function(t){var n=e("<div/>"),i=e("<img/>",{src:t.profile_picture_url,class:"profile-picture round"}),a=e("<div/>",{class:"details"}),o=e("<div/>",{class:"name"}).html(t.fullname),r=e("<div/>",{class:"email"}).html(t.email)
return t.email?a.append(o).append(r):(a.addClass("no-email"),a.append(o)),n.append(i).append(a),n.html()},replace:function(e){return" "+a.createTagElement("@"+e.fullname,"ping",e.id)[0].outerHTML+" "}}],{appendTo:".jquery-comments",dropdownClassName:"dropdown autocomplete",maxCount:5,rightEdgeOffset:0}),e.fn.textcomplete.Dropdown.prototype.render=function(t){var n=this._buildContents(t),i=e.map(t,function(e){return e.value})
if(t.length){var o=t[0].strategy
o.id?this.$el.attr("data-strategy",o.id):this.$el.removeAttr("data-strategy"),this._renderHeader(i),this._renderFooter(i),n&&(this._renderContents(n),this._fitToBottom(),this._fitToRight(),this._activateIndexedItem()),this._setScroll()}else this.noResultsMessage?this._renderNoResultsMessage(i):this.shown&&this.deactivate()
var r=parseInt(this.$el.css("top"))+a.options.scrollContainer.scrollTop()
this.$el.css("top",r)
var s=this.$el.css("left")
this.$el.css("left",0)
var l=a.$el.width()-this.$el.outerWidth(),d=Math.min(l,parseInt(s))
this.$el.css("left",d)}),o},createNavigationElement:function(){var t=e("<ul/>",{class:"navigation"}),n=e("<div/>",{class:"navigation-wrapper"})
t.append(n)
var i=e("<li/>",{text:this.options.textFormatter(this.options.newestText),"data-sort-key":"newest","data-container-name":"comments"}),a=e("<li/>",{text:this.options.textFormatter(this.options.popularText),"data-sort-key":"popularity","data-container-name":"comments"}),o=e("<div/>",{class:"navigation-wrapper responsive"}),r=e("<ul/>",{class:"dropdown"}),s=e("<li/>",{class:"title"}),l=e("<header/>")
return s.append(l),o.append(s),o.append(r),t.append(o),n.append(i),r.append(i.clone()),(this.options.enableReplying||this.options.enableUpvoting)&&(n.append(a),r.append(a.clone())),this.options.forceResponsive&&this.forceResponsive(),t},createSpinner:function(){var t=e("<div/>",{class:"spinner"}),n=e("<i/>",{class:"fa fa-spinner fa-spin"})
return this.options.spinnerIconURL.length&&(n.css("background-image",'url("'+this.options.spinnerIconURL+'")'),n.addClass("image")),t.html(n),t},createCommentElement:function(t){var n=e("<li/>",{"data-id":t.id,class:"comment"}).data("model",t)
t.createdByCurrentUser&&n.addClass("by-current-user"),t.createdByAdmin&&n.addClass("by-admin")
var i=e("<ul/>",{class:"child-comments"}),a=this.createCommentWrapperElement(t)
return n.append(a),null==t.parent&&n.append(i),n},createCommentWrapperElement:function(t){function n(){if(!M){requestAnimationFrame(n),B=0,U.getByteFrequencyData(E),D.fillStyle="#FFF",D.fillRect(0,0,L,F)
for(var e=0;e<$;e++)I=3*E[e],D.fillStyle="#2196F1",D.fillRect(B,F-I,A-3,I),B+=A+1}}var i=e("<div/>",{class:"comment-wrapper"}),a=this.createProfilePictureElement(t.profilePictureURL),o=e("<div/>",{class:"time",text:this.options.timeFormatter(t.created),"data-original":t.created}),r=t.createdByCurrentUser?this.options.textFormatter(this.options.youText):t.fullname,s=e("<div/>",{class:"name"})
if(t.profileURL){var l=e("<a/>",{href:t.profileURL,text:r})
s.html(l)}else s.text(r)
if((t.createdByCurrentUser||t.createdByAdmin)&&s.addClass("highlight-font-bold"),t.parent){var d=this.commentsById[t.parent]
if(d.parent){var c=e("<span/>",{class:"reply-to",text:d.fullname}),p=e("<i/>",{class:"fa fa-share"})
this.options.replyIconURL.length&&(p.css("background-image",'url("'+this.options.replyIconURL+'")'),p.addClass("image")),c.prepend(p),s.append(c)}}if(t.isNew){var m=e("<span/>",{class:"new highlight-background",text:this.options.newText})
s.append(m)}var h=e("<div/>",{class:"wrapper"}),u=e("<div/>",{class:"content"}),f=(e("<div/>",{class:"toggle-content"}),void 0!==t.fileURL)
if(f){var g=null,v=null
if(t.fileMimeType){var C=t.fileMimeType.split("/")
2===C.length&&(g=C[1],v=C[0])}var l=e("<a/>",{class:"attachment",href:t.fileURL,target:"_blank"})
if("image"===v){var b=e("<img/>",{src:t.fileURL})
l.html(b)}else if("video"===v){var w=e("<video/>",{src:t.fileURL,type:t.fileMimeType,controls:"controls"})
l.html(w)}else if("audio"===v){var y=e("<audio/>",{src:t.fileURL,type:t.fileMimeType,controls:"controls"})
l.html(y)
var x=e("<canvas/>")
l.prepend(x)
var T=y[0],k=x[0]
T.crossOrigin="anonymous"
var R=this.options.audioContext.createMediaElementSource(T),U=this.options.audioContext.createAnalyser()
k.width=window.innerWidth,k.height=window.innerHeight
var D=k.getContext("2d")
R.connect(U),U.connect(this.options.audioContext.destination),U.fftSize=256
var I,$=U.frequencyBinCount,E=new Uint8Array($),L=k.width,F=k.height,A=L/$*6,B=0,M=!0
y.bind("play",function(){M=!1,n()}),y.bind("pause ended",function(){setTimeout(function(){M=!0},1e3)})}else{var H=["archive","audio","code","excel","image","movie","pdf","photo","picture","powerpoint","sound","video","word","zip"],P="fa fa-file-o"
H.indexOf(g)>0?P="fa fa-file-"+g+"-o":H.indexOf(v)>0&&(P="fa fa-file-"+v+"-o")
var O=t.fileName,S=e("<div/>",{class:"attachment-wrapper"}),j=e("<i/>",{class:P})
this.options.fileIconURL.length&&(j.css("background-image",'url("'+this.options.fileIconURL+'")'),j.addClass("image"))
var N=e("<span/>",{text:O})
S.append(j).append(N),l.prepend(S)}u.html(l)}else{var z
if(t.content.length>300){var q=t.content.substr(250,t.content.length-1)
z=this.getFormattedCommentContent(t.content.substr(0,250+q.indexOf(" ")))+'...<span class="read-more-content"><span class="read-more-link read-more-'+t.id+'">Show more >></span></span>',u.html(z)
var W=e(".comments-container")
W.off("click","span.read-more-"+t.id),W.on("click","span.read-more-"+t.id,_.bind(function(n){var i
return e(n.currentTarget).hasClass("less")?(i=this.getFormattedCommentContent(t.content.substr(0,300+q.indexOf(" ")))+'...<span class="read-more-content"><span class="read-more-link read-more-'+t.id+'">Show more >></span></span>',u.html(i)):(i='<span class="comment-content">'+this.getFormattedCommentContent(t.content)+'</span><span class="less read-more-link read-more-'+t.id+'">Show less <<</span><span class="translate-link">Show translation</span>',u.html(i)),!1},this))}else z='<span class="comment-content">'+this.getFormattedCommentContent(t.content)+'</span><span class="translate-link">Show translation</span>',u.html(z)}if(t.modified&&t.modified!==t.created){var K=this.options.timeFormatter(t.modified),V=e("<time/>",{class:"edited",text:this.options.textFormatter(this.options.editedText)+" "+K,"data-original":t.modified})
u.children().first().after(V)}var Z=e("<div/>",{class:"actions"}),J=e("<div/>",{class:"mdl-button action reply",type:"button",text:this.options.textFormatter(this.options.replyText)}),Q=e('<i class="material-icons">thumb_up</i>')
this.options.upvoteIconURL.length&&(Q.css("background-image",'url("'+this.options.upvoteIconURL+'")'),Q.addClass("image"))
var Y=this.createUpvoteElement(t),G=e('<i class="material-icons">thumb_down</i>')
this.options.downvoteIconURL.length&&(G.css("background-image",'url("'+this.options.downvoteIconURL+'")'),G.addClass("image"))
var X=this.createDownvoteElement(t)
if(this.options.enableReplying&&Z.append(J),t.createdByCurrentUser||this.options.currentUserIsAdmin)if(f&&this.isAllowedToDelete(t.id)){var ee=e("<div/>",{class:"mdl-button action delete enabled",text:this.options.textFormatter(this.options.deleteText)})
Z.append(ee)}else if(!f&&this.options.enableEditing){var te=e("<div/>",{class:"mdl-button action edit",text:this.options.textFormatter(this.options.editText)})
Z.append(te)}this.options.enableDownvoting&&Z.append(X),this.options.enableUpvoting&&Z.append(Y),h.append(u),h.append(Z)
var ne=e("<div/>",{class:"comment-info-wrapper"})
return ne.append(a).append(s).append(o),i.append(ne).append(h),i},createUpvoteElement:function(t){var n=e('<i class="material-icons">thumb_up</i>')
return this.options.upvoteIconURL.length&&(n.css("background-image",'url("'+this.options.upvoteIconURL+'")'),n.addClass("image")),e("<button/>",{class:"action upvote"+(t.userHasUpvoted?" highlight-font":"")}).append(e("<span/>",{text:t.upvoteCount,class:"upvote-count"})).append(n)},createDownvoteElement:function(t){var n=e('<i class="material-icons">thumb_down</i>')
return this.options.downvoteIconURL.length&&(n.css("background-image",'url("'+this.options.downvoteIconURL+'")'),n.addClass("image")),e("<button/>",{class:"action downvote"+(t.userHasDownvoted?" red-highlight-font":"")}).append(e("<span/>",{text:t.downvoteCount,class:"downvote-count"})).append(n)},createTagElement:function(t,n,i){var a=e("<input/>",{class:"tag",type:"button","data-role":"none"})
return n&&a.addClass(n),a.val(t),a.attr("data-value",i),a},reRenderComment:function(t){var n=this.commentsById[t],i=this
this.$el.find('li.comment[data-id="'+n.id+'"]').each(function(t,a){var o=i.createCommentWrapperElement(n)
e(a).find(".comment-wrapper").first().replaceWith(o)})},reRenderCommentActionBar:function(t){var n=this.commentsById[t],i=this
this.$el.find('li.comment[data-id="'+n.id+'"]').each(function(t,a){var o=i.createCommentWrapperElement(n)
e(a).find(".actions").first().replaceWith(o.find(".actions"))})},reRenderUpvotes:function(t){var n=this.commentsById[t],i=this
this.$el.find('li.comment[data-id="'+n.id+'"]').each(function(t,a){var o=i.createUpvoteElement(n)
e(a).find(".upvote").first().replaceWith(o)})},reRenderDownvotes:function(t){var n=this.commentsById[t],i=this
this.$el.find('li.comment[data-id="'+n.id+'"]').each(function(t,a){var o=i.createDownvoteElement(n)
e(a).find(".downvote").first().replaceWith(o)})},createCssDeclarations:function(){e("head style.jquery-comments-css").remove(),this.createCss(".jquery-comments ul.navigation li.active:after {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments ul.navigation ul.dropdown li.active {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments .highlight-background {background: "+this.options.highlightColor+" !important;",NaN),this.createCss(".jquery-comments .highlight-font {color: "+this.options.highlightColor+" !important;}"),this.createCss(".jquery-comments .highlight-font-bold {color: "+this.options.highlightColor+" !important;font-weight: bold;}"),this.createCss(".jquery-comments .red-highlight-font {color: "+this.options.deleteButtonColor+" !important;}"),this.createCss(".jquery-comments .red-highlight-font-bold {color: "+this.options.deleteButtonColor+" !important;font-weight: bold;}")},createCss:function(t){var n=e("<style/>",{type:"text/css",class:"jquery-comments-css",text:t})
e("head").append(n)},getComments:function(){var e=this
return Object.keys(this.commentsById).map(function(t){return e.commentsById[t]})},getUsers:function(){var e=this
return Object.keys(this.usersById).map(function(t){return e.usersById[t]})},getChildComments:function(e){return this.getComments().filter(function(t){return t.parent===e})},getAttachments:function(){return this.getComments().filter(function(e){return void 0!==e.fileURL})},getOutermostParent:function(e){var t,n=e
do{t=this.commentsById[n],n=t.parent}while(null!=t.parent)
return t},createCommentJSON:function(e){var t=(new Date).toISOString()
return{id:"c"+(this.getComments().length+1),parent:e.attr("data-parent")||null,created:t,modified:t,content:this.getTextareaContent(e),pings:this.getPings(e),fullname:this.options.textFormatter(this.options.youText),profilePictureURL:this.options.profilePictureURL,createdByCurrentUser:!0,upvoteCount:0,downvoteCount:0,userHasUpvoted:!1,userHasDownvoted:!1}},isAllowedToDelete:function(t){if(this.options.enableDeleting){var n=!0
return this.options.enableDeletingCommentWithReplies||e(this.getComments()).each(function(e,i){i.parent===t&&(n=!1)}),n}return!1},setToggleAllButtonText:function(e,t){var n=this,i=e.find("span.text"),a=e.find(".caret"),o=function(){var t=n.options.textFormatter(n.options.viewAllRepliesText),a=e.siblings(".comment").length
t=t.replace("__replyCount__",a),i.text(t)},r=this.options.textFormatter(this.options.hideRepliesText)
t?(i.text()===r?o():i.text(r),a.toggleClass("up")):i.text()!==r&&o()},adjustTextareaHeight:function(t,n){var i=t.parents().siblings(".profile-picture-wrapper").length>0?t.parents().siblings(".profile-picture-wrapper"):this.profilePictureWrapper
t=e(t)
var a,o,r=1==n?this.options.textareaRowsOnFocus:this.options.textareaRows
do{!function(e){var n=2+e
t.css("height",n+"em"),i.css("height",n+"em")}(r),r++,a=t[0].scrollHeight>t.outerHeight(),o=!1!==this.options.textareaMaxRows&&r>this.options.textareaMaxRows}while(a&&!o)},clearTextarea:function(e){e.empty().trigger("input")},getTextareaContent:function(t,n){var i=t.clone()
i.find(".reply-to.tag").remove(),i.find(".tag.hashtag").replaceWith(function(){return n?e(this).val():"#"+e(this).attr("data-value")}),i.find(".tag.ping").replaceWith(function(){return n?e(this).val():"@"+e(this).attr("data-value")})
var a=e("<pre/>").html(i.html())
a.find("div, p, br").replaceWith(function(){return"\n"+this.innerHTML})
var o=a.text().replace(/^\s+/g,"")
return o=this.normalizeSpaces(o)},getFormattedCommentContent:function(e,t){var n=this.escape(e)
return n=this.linkify(n),t&&(n=n.replace(/(?:\n)/g,"<br>")),n},getPings:function(t){return e.map(t.find(".ping"),function(t){return parseInt(e(t).attr("data-value"))})},moveCursorToEnd:function(t){if(t=e(t)[0],e(t).trigger("input"),e(t).scrollTop(t.scrollHeight),void 0!==window.getSelection&&void 0!==document.createRange){var n=document.createRange()
n.selectNodeContents(t),n.collapse(!1)
var i=window.getSelection()
i.removeAllRanges(),i.addRange(n)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange()
a.moveToElementText(t),a.collapse(!1),a.select()}t.focus()},escape:function(t){return e("<pre/>").text(this.normalizeSpaces(t)).html()},normalizeSpaces:function(e){return e.replace(new RegExp("Â ","g")," ")},after:function(e,t){var n=this
return function(){if(0===--e)return t.apply(n,arguments)}},highlightTags:function(e,t){return this.options.enableHashtags&&(t=this.highlightHashtags(e,t)),this.options.enablePinging&&(t=this.highlightPings(e,t)),t},highlightHashtags:function(e,t){var n=this
if(-1!==t.indexOf("#")){var i=function(e){return n.createTagElement("#"+e,"hashtag",e)[0].outerHTML},a=/(^|\s)#([a-zÃ¤Ã¶Ã¼Ã\d-_]+)/gim
t=t.replace(a,function(e,t,n){return t+i(n)})}return t},highlightPings:function(t,n){var i=this
if(-1!==n.indexOf("@")){var a=function(e){return i.createTagElement("@"+e.fullname,"ping",e.id)[0].outerHTML},o=""
return e(t.pings).each(function(e,t){if(t in i.usersById){var r=i.usersById[t],s="@"+r.fullname,l=n.indexOf(s)+s.length,d=n.slice(0,l)
o+=d.replace(s,a(r)),n=n.slice(l)}}),o+=n}return n},linkify:function(e){var t,n,i,a
if(n=/(^|\s)((https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=e.replace(n,'$1<a href="$2" target="_blank">$2</a>'),i=/(^|\s)(www\.[\S]+(\b|$))/gim,t=t.replace(i,'$1<a href="http://$2" target="_blank">$2</a>'),a=/(^|\s)(([a-zA-Z0-9\-\_\.]+)@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(a,'$1<a href="mailto:$2">$2</a>'),(e.match(/<a href/g)||[]).length>0){for(var o=e.split(/(<\/a>)/g),r=0;r<o.length;r++)null==o[r].match(/<a href/g)&&(o[r]=o[r].replace(n,'<a href="$1" target="_blank">$1</a>').replace(i,'$1<a href="http://$2" target="_blank">$2</a>').replace(a,'<a href="mailto:$1">$1</a>'))
return o.join("")}return t},waitUntil:function(e,t){var n=this
e()?t():setTimeout(function(){n.waitUntil(e,t)},100)},applyInternalMappings:function(e){var t={},n=this.options.fieldMappings
for(var i in n)n.hasOwnProperty(i)&&(t[n[i]]=i)
return this.applyMappings(t,e)},applyExternalMappings:function(e){var t=this.options.fieldMappings
return this.applyMappings(t,e)},applyMappings:function(e,t){var n={}
for(var i in t)if(i in e){var a=e[i]
n[a]=t[i]}return n}}
e.fn.comments=function(n){return this.each(function(){var i=Object.create(t)
e.data(this,"comments",i),i.init(n||{},this)})}})
